#!/bin/bash
#Galindo Díaz Sergio Iván
#Transferencia de Zonas
#Curso Pentest

function Filtro {
	 echo "Filtrando..."
#Obtención de los dominios	
  awk '{print $1}' tmp | sed 's/\.$//g' | sort -u > domains.tmp
#Obtención de las direcciones ip's y los dominios 
  awk '{print $NF}' tmp | sort -u > results.tmp
#Redirección de  dominios al archivo domains.tmp
  grep -E "\.$" results.tmp | sed 's/\.$//g' >> domains.tmp
#Ordenamiento y redirección de ip's al archivo ipaddress.lst 
  grep -oE "[0-9]{1,3}(\.[0-9]{1,3}){3}" results.tmp | sort -u > ipaddress.lst
#Ordenamiento de dominios
  sort -u domains.tmp >> domains.lst
}
#Funcion que obtendra el nombre de los servidores del dominio y los guarda en la variable NAMESERVERS
function NameServers {

  echo "Servidores disponibles...."
  local NAMESERVERS=`dig NS $DOMAIN | grep -E "IN" | \
    grep -oE "[0-9a-z\.\-]*\.$|[0-9]{1,3}(\.[0-9]{1,3}){3}" | sed 's/\.$//g'`

  ZoneTransfer $NAMESERVERS

}
#Impresión de resultados
function Results {

  echo " Dominios: `cat domains.lst | wc -l`"
  echo " IPs: `cat ipaddress.lst | wc -l`"

}
#Funcion de manejo del script
function Uso {

  echo "Se requiere el nombre de dominio"
  echo "Sintaxis:   $0 <domain>"
  echo -e "Ej. $0 cnn.com\n\t  $0 sun.com"
  exit 1

}
# transferencia del dominio objetivo a nuestra zona de transferencia
function ZoneTransfer() {

  local I=""
  for I in $@; do

    echo " [+] Testing: $I"
    dig axfr $DOMAIN @$I | grep -E "IN" >> tmp

  done

#Si no hay caracteres, la vulnerabilidad no se completo
  [ ! -s tmp ] && echo "TRansferencia finalizada" && rm tmp && exit 2

}

[ $# -lt 1 ] || [ $# -gt 1 ] && Uso || DOMAIN=$1
# Funcion NameServers
NameServers

# Funcion  Filter
Filtro